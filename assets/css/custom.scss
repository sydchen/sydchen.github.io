// Variables
$code-light-bg: #fff5f5;
$code-light-color: #d73a49;
$code-light-border: #e0e0e0;

$code-dark-bg: #2a1e1e;
$code-dark-color: #c45f6a;
$code-dark-border: #4a2c2c;

$toc-light-bg: #ffffff;
$toc-light-border: #d0d7de;
$toc-light-title-color: #24292f;
$toc-light-link-color: #57606a;
$toc-light-link-hover: #0969da;

$toc-dark-bg: #0d1117;
$toc-dark-border: #30363d;
$toc-dark-title-color: #c9d1d9;
$toc-dark-link-color: #8b949e;
$toc-dark-link-hover: #58a6ff;

// Mixin for inline code styles
@mixin inline-code-style($bg, $color, $border) {
  background: $bg !important;
  color: $color !important;
  font-size: 0.95em !important;
  padding: 0 0.1em !important;
  border-radius: 4px !important;
  border: 1px solid $border !important;
}

// Mixin for TOC dark mode styles
@mixin toc-dark-mode {
  .toc-sidebar {
    background: $toc-dark-bg;
    border-color: $toc-dark-border;
  }

  .toc-title {
    border-bottom-color: $toc-dark-border;
    color: $toc-dark-title-color;
  }

  .toc-nav a {
    color: $toc-dark-link-color;

    &:hover {
      color: $toc-dark-link-hover;
    }
  }
}

// Light mode - inline code
.markdown-body :not(pre) > code,
:not(pre) > code {
  @include inline-code-style($code-light-bg, $code-light-color, $code-light-border);
}

// Dark mode - inline code
html[data-color-mode="dark"] {
  .markdown-body :not(pre) > code,
  :not(pre) > code {
    @include inline-code-style($code-dark-bg, $code-dark-color, $code-dark-border);
  }
}

@media (prefers-color-scheme: dark) {
  .markdown-body :not(pre) > code,
  :not(pre) > code {
    @include inline-code-style($code-dark-bg, $code-dark-color, $code-dark-border);
  }
}

// Font family
body {
  font-family: "JetBrains Mono", "Fira Code", "Cascadia Code",
               "Source Code Pro", Consolas, Monaco, monospace;
}

// Links
a:hover {
  text-decoration: none !important;
  filter: brightness(1.2);
}

// Remove border from file class
.file {
  border: none !important;
}

// Lighter text color for search input
.Header-search-input {
  color: #6e7781 !important;

  &::placeholder {
    color: #6e7781 !important;
    opacity: 0.7;
  }
}

// Code block with copy button
.code-block-wrapper {
  position: relative;

  &:hover .copy-code-button {
    opacity: 1;
  }
}

.copy-code-button {
  position: absolute;
  top: 8px;
  right: 8px;
  padding: 6px 8px;
  background: #f6f8fa;
  border: 1px solid #d0d7de;
  border-radius: 6px;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s, background 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #24292f;

  &:hover {
    background: #e7e9eb;
  }

  &.copied {
    color: #1a7f37;
  }

  svg {
    width: 16px;
    height: 16px;
  }
}

html[data-color-mode="dark"] {
  .Header-search-input {
    color: #8b949e !important;

    &::placeholder {
      color: #8b949e !important;
      opacity: 0.7;
    }
  }

  .copy-code-button {
    background: #21262d;
    border-color: #30363d;
    color: #c9d1d9;

    &:hover {
      background: #30363d;
    }

    &.copied {
      color: #3fb950;
    }
  }
}

@media (prefers-color-scheme: dark) {
  .Header-search-input {
    color: #8b949e !important;

    &::placeholder {
      color: #8b949e !important;
      opacity: 0.7;
    }
  }

  .copy-code-button {
    background: #21262d;
    border-color: #30363d;
    color: #c9d1d9;

    &:hover {
      background: #30363d;
    }

    &.copied {
      color: #3fb950;
    }
  }
}

// Post Layout with TOC
.post-layout {
  display: flex;
  gap: 2rem;
  max-width: 100%;
  margin: 0 auto;
  align-items: flex-start;

  .repository-content {
    flex: 1;
    min-width: 0;
    max-width: 1080px;
    width: 100%;
  }
}

// When there's no TOC, center and limit content width
.post-layout:not(:has(.toc-sidebar)) .repository-content {
  max-width: 800px;
  margin: 0 auto;
}

// Responsive adjustments
@media only screen and (max-width: 1440px) {
  .post-layout .repository-content {
    max-width: none;
    width: 60%;
  }

  // Keep centered width when no TOC
  .post-layout:not(:has(.toc-sidebar)) .repository-content {
    max-width: 800px;
    width: 90%;
  }
}

@media only screen and (max-width: 1280px) {
  .post-layout .repository-content {
    width: 56%;
  }

  // Keep centered width when no TOC
  .post-layout:not(:has(.toc-sidebar)) .repository-content {
    max-width: 800px;
    width: 90%;
  }
}

@media (max-width: 1200px) {
  .post-layout {
    flex-direction: column;

    .repository-content {
      width: 90%;
      max-width: 900px;
      margin: 0 auto;
    }
  }

  .toc-sidebar {
    display: none;
  }
}

.new-discussion-timeline {
  max-width: 1200px !important;
}

// Sidebar TOC
.toc-sidebar {
  width: 280px;
  flex-shrink: 0;
  position: sticky;
  top: 100px;
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  font-size: 13px;
  background: #ffffff;
  border: 1px solid #d0d7de;
  border-radius: 6px;
  padding: 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);

  // Hide scrollbar
  &::-webkit-scrollbar {
    width: 0;
    display: none;
  }

  -ms-overflow-style: none;
  scrollbar-width: none;
}

.toc-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid #d0d7de;
  color: #24292f;
}

.toc-nav {
  nav {
    line-height: 1.6;
  }

  ul {
    list-style: none;
    padding-left: 0;
    margin: 0;

    ul {
      padding-left: 16px;
    }
  }

  li {
    margin: 0;
  }

  a {
    display: block;
    color: #57606a;
    text-decoration: none;
    padding: 4px 0;
    transition: color 0.2s;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;

    &:hover {
      color: #0969da;
      filter: brightness(1.2);
    }
  }
}

// Dark mode for TOC
html[data-color-mode="dark"] {
  @include toc-dark-mode;
}

@media (prefers-color-scheme: dark) {
  @include toc-dark-mode;
}

// Override title max-width to show full title
.css-truncate.css-truncate-target {
  max-width: none !important;
}
